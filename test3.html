<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Fingerprint Inspector</title>
  <script src="fingerprint2.js"></script>
  <style>
    /* ... (–≤–∞—à–∏ —Ç–µ–∫—É—â–∏–µ —Å—Ç–∏–ª–∏) ... */
    .duplicate {
      background-color: #ffdddd !important;
      border-left: 4px solid #ff6b6b;
    }
    .new {
      background-color: #ddffdd !important;
      border-left: 4px solid #6bff6b;
    }
  </style>
</head>
<body>
  <h1>Fingerprint Inspector</h1>
  <div id="stats"></div>
  <div id="table-container">–ó–∞–≥—Ä—É–∑–∫–∞ –æ—Ç–ø–µ—á–∞—Ç–∫–æ–≤...</div>

  <script>
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ö–µ—à–∞ —Ñ–∏–Ω–≥–µ—Ä–ø—Ä–∏–Ω—Ç–∞
    function getFingerprintHash(components) {
      const str = components.map(c => c.key + ':' + JSON.stringify(c.value)).join('|');
      return btoa(encodeURIComponent(str)).slice(0, 32); // –£–ø—Ä–æ—â—ë–Ω–Ω—ã–π —Ö–µ—à
    }

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–∏–Ω–≥–µ—Ä–ø—Ä–∏–Ω—Ç—ã
    function saveFingerprint(components) {
      const hash = getFingerprintHash(components);
      const saved = JSON.parse(localStorage.getItem('fingerprints') || '[]');
      
      if (!saved.includes(hash)) {
        saved.push(hash);
        localStorage.setItem('fingerprints', JSON.stringify(saved));
      }
      return hash;
    }

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥—É–±–ª–∏–∫–∞—Ç—ã
    function checkDuplicates(components, currentHash) {
      const savedComponents = JSON.parse(localStorage.getItem('fingerprint_data') || '{}');
      const duplicates = {};

      components.forEach(component => {
        const savedValue = savedComponents[component.key];
        if (savedValue && JSON.stringify(savedValue) === JSON.stringify(component.value)) {
          duplicates[component.key] = true;
        }
      });

      // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –±—É–¥—É—â–∏—Ö —Å—Ä–∞–≤–Ω–µ–Ω–∏–π
      const newData = {};
      components.forEach(c => { newData[c.key] = c.value; });
      localStorage.setItem('fingerprint_data', JSON.stringify(newData));

      return duplicates;
    }

    // –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞
    window.addEventListener('load', function() {
      setTimeout(function() {
        Fingerprint2.get(function(components) {
          const currentHash = saveFingerprint(components);
          const duplicates = checkDuplicates(components, currentHash);
          const isNewVisitor = !localStorage.getItem('firstVisit');

          if (isNewVisitor) {
            localStorage.setItem('firstVisit', '1');
            document.getElementById('stats').innerHTML = 
              '<p style="color: green;">–≠—Ç–æ –≤–∞—à –ø–µ—Ä–≤—ã–π –≤–∏–∑–∏—Ç. –§–∏–Ω–≥–µ—Ä–ø—Ä–∏–Ω—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω.</p>';
          } else {
            const totalFingerprints = JSON.parse(localStorage.getItem('fingerprints') || []).length;
            document.getElementById('stats').innerHTML = 
              `<p>–í—ã –ø–æ—Å–µ—â–∞–ª–∏ —ç—Ç—É —Å—Ç—Ä–∞–Ω–∏—Ü—É ${totalFingerprints} —Ä–∞–∑(–∞).</p>`;
          }

          // –°–æ–∑–¥–∞—ë–º —Ç–∞–±–ª–∏—Ü—É
          const table = document.createElement('table');
          const thead = document.createElement('thead');
          const tbody = document.createElement('tbody');

          thead.innerHTML = `
            <tr>
              <th>–ü–∞—Ä–∞–º–µ—Ç—Ä</th>
              <th>–ó–Ω–∞—á–µ–Ω–∏–µ</th>
              <th>–°—Ç–∞—Ç—É—Å</th>
            </tr>
          `;

          components.forEach(function(component) {
            const tr = document.createElement('tr');
            if (duplicates[component.key]) {
              tr.classList.add('duplicate');
            } else if (isNewVisitor) {
              tr.classList.add('new');
            }

            const tdKey = document.createElement('td');
            tdKey.textContent = component.key;

            const tdValue = document.createElement('td');
            tdValue.textContent = typeof component.value === 'string' 
              ? component.value.slice(0, 100) 
              : JSON.stringify(component.value).slice(0, 100);

            const tdStatus = document.createElement('td');
            tdStatus.textContent = duplicates[component.key] ? 'üîÑ –î—É–±–ª–∏–∫–∞—Ç' : 'üÜï –ù–æ–≤—ã–π';

            tr.appendChild(tdKey);
            tr.appendChild(tdValue);
            tr.appendChild(tdStatus);
            tbody.appendChild(tr);
          });

          table.appendChild(thead);
          table.appendChild(tbody);
          document.getElementById('table-container').replaceChildren(table);
        });
      }, 500);
    });
  </script>
</body>
</html>